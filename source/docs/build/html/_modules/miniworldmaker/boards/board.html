<!doctype html>
<html class="no-js">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><link rel="index" title="Index" href="../../../genindex.html" /><link rel="search" title="Search" href="../../../search.html" />

    <meta name="generator" content="sphinx-3.5.4, furo 2021.04.11.beta34"/>
        <title>miniworldmaker.boards.board - miniworldmaker 2021 documentation</title>
      <link rel="stylesheet" href="../../../_static/styles/furo.css?digest=59ab60ac09ea94ccfe6deddff6d715cce948a6fc">
    <link rel="stylesheet" href="../../../_static/pygments.css">
    <link media="(prefers-color-scheme: dark)" rel="stylesheet" href="../../../_static/pygments_dark.css">
    


<style>
  :root {
    --color-code-background: #eeffcc;
  --color-code-foreground: black;
  
  }
  @media (prefers-color-scheme: dark) {
    :root {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
  }

  /* For allowing end-user-specific overrides */
  .override-light {
    --color-code-background: #eeffcc;
  --color-code-foreground: black;
  
  }
  .override-dark {
    --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
  }
</style><link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css" />
    <link rel="stylesheet" href="../../../_static/styles/furo-extensions.css?digest=d391b54134226e4196576da3bdb6dddb7e05ba2b"></head>
  <body dir="">
    
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke-width="1.5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z"/>
      <line x1="4" y1="6" x2="20" y2="6" />
      <line x1="10" y1="12" x2="20" y2="12" />
      <line x1="6" y1="18" x2="20" y2="18" />
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
      class="feather feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
      class="feather feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation"></label>
<label class="overlay toc-overlay" for="__toc"></label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../../index.html"><div class="brand">miniworldmaker 2021 documentation</div></a>
    </div>
    <div class="header-right">
      <label class="toc-overlay-icon toc-header-icon no-toc" for="__toc">
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../../index.html">
  
  
  <span class="sidebar-brand-text">miniworldmaker 2021 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../../../search.html">
  <input class="sidebar-search" placeholder=Search name="q">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../mwm.html">MiniWorldMaker</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../tutorial_german.html">Tutorial - Deutsch</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label for="toctree-checkbox-1"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../de/00_installation.html">1. Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../de/01_board.html">2. The Board</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../de/02_tokens.html">3. Tokens</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../de/03_actions.html">4. Aktionen / Methoden registrieren</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../de/04_movement.html">5. Bewegung</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../de/05_events.html">6. Ereignisse</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../de/06_sensing.html">7. Kollisionen und Sensoren</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../de/07_costumes.html">8. Kost√ºme</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../de/08%20animations.html">9. Animationen</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../de/09_timers.html">10. Timer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../de/10_status.html">11. Status: Spielstand/Spielende/Levels</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../de/11_physics.html">12. Physik</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../tutorial_english.html">Tutorial - English</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label for="toctree-checkbox-2"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../en/00_installation.html">1. Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../en/01_board.html">2. The playing field</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../en/02_tokens.html">3. Tokens</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../en/03_directions.html">4. Directions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../en/04_movement.html">5. Movements</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../en/05_sensing.html">6. Sensing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../en/06_events.html">7. events</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../en/07_costumes.html">8. Costumes and Background</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../en/08_animations.html">9. Animations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../en/09_gui.html">10. GUI elements</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../en/10_physics.html">11. physics</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../api.html">API</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label for="toctree-checkbox-3"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../api/appearance.html">Appearance</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/appearance.background.html">Appearance.Background</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/appearance.costume.html">Appearance.Costume</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/board.html">Board</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/board.pixelboard.html">Board.PixelBoard</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/board.tiledboard.html">Board.TiledBoard</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/board_position.html">BoardPositions, Lines and Rectangles</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/physics.html">Physics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/token.html">Token</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/token.numbertoken.html">Token.NumberToken</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/token.shape.html">Token.Shape</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/token.texttoken.html">Token.TextToken</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../key_concepts.html">Key Concepts</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label for="toctree-checkbox-4"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../key_concepts/boards.html">Boards</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../key_concepts/collisions.html">Collisions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../key_concepts/costumes.html">Costumes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../key_concepts/directions.html">Directions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../key_concepts/events.html">Events</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../key_concepts/movement.html">Movement</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../key_concepts/physics.html">Physics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../key_concepts/sensors.html">Sensors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../key_concepts/tokens.html">Tokens</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../impressum.html">Impressum</a></li>
</ul>

</div>
</div>
      </div>
      
    </div>
  </aside>
  <main class="main">
    <div class="content">
      <article role="main">
        <label class="toc-overlay-icon toc-content-icon no-toc" for="__toc">
          <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
        </label>
        <h1>Source code for miniworldmaker.boards.board</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">inspect</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>
<span class="kn">from</span> <span class="nn">inspect</span> <span class="kn">import</span> <span class="n">signature</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Union</span>

<span class="kn">import</span> <span class="nn">pygame</span>
<span class="kn">from</span> <span class="nn">miniworldmaker.app</span> <span class="kn">import</span> <span class="n">app</span>
<span class="kn">from</span> <span class="nn">miniworldmaker.appearances</span> <span class="kn">import</span> <span class="n">background</span>
<span class="kn">from</span> <span class="nn">miniworldmaker.board_positions</span> <span class="kn">import</span> <span class="n">board_position</span>
<span class="kn">from</span> <span class="nn">miniworldmaker.board_positions</span> <span class="kn">import</span> <span class="n">board_rect</span>
<span class="kn">from</span> <span class="nn">miniworldmaker.containers</span> <span class="kn">import</span> <span class="n">container</span>
<span class="kn">from</span> <span class="nn">miniworldmaker.physics</span> <span class="kn">import</span> <span class="n">physics</span>
<span class="kn">from</span> <span class="nn">miniworldmaker.tools</span> <span class="kn">import</span> <span class="n">timer</span>
<span class="kn">from</span> <span class="nn">miniworldmaker.physics</span> <span class="kn">import</span> <span class="n">physics</span> <span class="k">as</span> <span class="n">physicsengine</span>
<span class="kn">from</span> <span class="nn">miniworldmaker.tokens</span> <span class="kn">import</span> <span class="n">token</span> <span class="k">as</span> <span class="n">tkn</span>
<span class="kn">from</span> <span class="nn">miniworldmaker.tools</span> <span class="kn">import</span> <span class="n">db_manager</span>


<span class="k">class</span> <span class="nc">MetaBoard</span><span class="p">(</span><span class="nb">type</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">instance</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__call__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c1">#if hasattr(instance, "on_setup"):</span>
        <span class="c1">#    instance.on_setup()</span>
        <span class="c1">#if hasattr(instance, "setup"):</span>
        <span class="c1">#    instance.setup()</span>
        <span class="k">return</span> <span class="n">instance</span>


<div class="viewcode-block" id="Board"><a class="viewcode-back" href="../../../api/board.html#miniworldmaker.boards.board.Board">[docs]</a><span class="k">class</span> <span class="nc">Board</span><span class="p">(</span><span class="n">container</span><span class="o">.</span><span class="n">Container</span><span class="p">,</span> <span class="n">metaclass</span><span class="o">=</span><span class="n">MetaBoard</span><span class="p">):</span>
    <span class="sd">"""Base Class for Boards.</span>

<span class="sd">    You can create a custom board by inherit one of Board subclasses or by creating a board-object:</span>

<span class="sd">    Examples:</span>
<span class="sd">        Creating a board object:</span>
<span class="sd">        </span>
<span class="sd">        .. code-block:: python</span>

<span class="sd">            board = miniworldmaker.TiledBoard()</span>
<span class="sd">            board.columns=20</span>
<span class="sd">            board.rows=8</span>
<span class="sd">            board.tile_size=40</span>

<span class="sd">        A pixel-board in follow_the_mouse.py:</span>
<span class="sd">        </span>
<span class="sd">        .. code-block:: python</span>
<span class="sd">            </span>
<span class="sd">            class MyBoard(PixelBoard):</span>
<span class="sd">            </span>
<span class="sd">            def on_setup(self):</span>
<span class="sd">                self.add_image(path="images/stone.jpg")</span>
<span class="sd">                Robot(position=(50, 50))</span>
<span class="sd">            </span>
<span class="sd">            </span>
<span class="sd">            board = MyBoard(800, 600)</span>
<span class="sd">        </span>
<span class="sd">        A tiled-board:</span>

<span class="sd">        .. code-block:: python</span>
<span class="sd">        </span>
<span class="sd">            def on_setup(self):</span>
<span class="sd">                self.add_image(path="images/soccer_green.jpg")</span>
<span class="sd">                self.player = Player(position=(3, 4))</span>
<span class="sd">                self.speed = 10</span>
<span class="sd">                stone = self.add_background(("images/stone.png"))</span>
<span class="sd">                stone.is_textured = True</span>
<span class="sd">                stone.is_scaled_to_tile = True</span>
<span class="sd">        </span>
<span class="sd">        </span>
<span class="sd">            board = MyBoard(columns=20, rows=8, tile_size=42, tile_margin=0)</span>

<span class="sd">        &gt; See [Example](https://codeberg.org/a_siebel/miniworldmaker/src/branch/main/examples/basics)</span>

<span class="sd">    Args:</span>
<span class="sd">        columns: columns of new board (default: 40)</span>
<span class="sd">        rows: rows of new board (default:40)</span>

<span class="sd">    """</span>

    <span class="n">registered_collision_handlers_for_tokens</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
    <span class="n">token_class_ids</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">()</span>  <span class="c1"># class_name -&gt; id</span>
    <span class="n">token_classes</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">()</span>  <span class="c1"># class_name -&gt; class</span>
    <span class="n">token_class_id_counter</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">subclasses</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">begin_prefix</span> <span class="o">=</span> <span class="s2">"on_touching_"</span>
    <span class="n">separate_prefix</span> <span class="o">=</span> <span class="s2">"on_separation_from_"</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">columns</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">40</span><span class="p">,</span>
                 <span class="n">rows</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">40</span><span class="p">,</span>
                 <span class="n">tile_size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                 <span class="n">tile_margin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                 <span class="n">background_image</span><span class="o">=</span><span class="kc">None</span>
                 <span class="p">):</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="n">pygame</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>
        <span class="c1"># public</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">registered_events</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"all"</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_running</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sound_effects</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">physics_property</span> <span class="o">=</span> <span class="n">physicsengine</span><span class="o">.</span><span class="n">PhysicsProperty</span>
        <span class="c1"># protected</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_is_setup</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">"_fps"</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_fps</span> <span class="o">=</span> <span class="mi">60</span>  <span class="c1"># property speed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tokens</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">LayeredDirty</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_key_pressed</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_animated</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_grid</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_orientation</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_repaint_all</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">columns</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">int</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">int</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">columns</span><span class="p">)</span> <span class="o">==</span> <span class="nb">tuple</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="nb">int</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="nb">int</span><span class="p">:</span>
                <span class="n">columns</span><span class="p">,</span> <span class="n">rows</span> <span class="o">=</span> <span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">columns</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">"ERROR: columns and rows should be int values but types are"</span><span class="p">,</span>
                            <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">columns</span><span class="p">)),</span> <span class="s2">"and"</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">rows</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_columns</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rows</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_margin</span> <span class="o">=</span> <span class="n">columns</span><span class="p">,</span> <span class="n">rows</span><span class="p">,</span> <span class="n">tile_size</span><span class="p">,</span> <span class="n">tile_margin</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_grid</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_grid</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
            <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_grid</span><span class="p">[</span><span class="n">row</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">background</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">backgrounds</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_background</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_image</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">Surface</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">surface</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">Surface</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_speed</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1"># All tokens are acting on n'th frame with n = self.speed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clock</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">Clock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__last_update</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">get_ticks</span><span class="p">()</span>
        <span class="c1"># Init graphics</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_app</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">App</span><span class="p">(</span><span class="s2">"MiniWorldMaker"</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_app</span><span class="o">.</span><span class="n">add_container</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">"top_left"</span><span class="p">)</span>
        <span class="n">app</span><span class="o">.</span><span class="n">App</span><span class="o">.</span><span class="n">board</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">registered_event_handlers</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tokens_with_eventhandler</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tokens_with_collisionhandler</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">background_image</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_background</span><span class="p">(</span><span class="n">background_image</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dirty</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timed_objects</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_repaint_all</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_executed_events</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">send_event_to_containers</span><span class="p">(</span><span class="s2">"setup"</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

<div class="viewcode-block" id="Board.from_db"><a class="viewcode-back" href="../../../api/board.html#miniworldmaker.boards.board.Board.from_db">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_db</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">file</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Loads a sqlite db file.</span>
<span class="sd">        """</span>
        <span class="n">db</span> <span class="o">=</span> <span class="n">db_manager</span><span class="o">.</span><span class="n">DBManager</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">select_single_row</span><span class="p">(</span><span class="s2">"SELECT rows, columns, tile_size, tile_margin, board_class FROM Board"</span><span class="p">)</span>
        <span class="n">board</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">()</span>
        <span class="n">board</span><span class="o">.</span><span class="n">rows</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">board</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">board</span><span class="o">.</span><span class="n">_tile_size</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">board</span><span class="o">.</span><span class="n">_tile_margin</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">select_all_rows</span><span class="p">(</span><span class="s2">"SELECT token_id, column, row, token_class FROM token"</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">data</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">tokens</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
                <span class="n">token_class_name</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
                <span class="n">token_class</span> <span class="o">=</span> <span class="n">tkn</span><span class="o">.</span><span class="n">Token</span>
                <span class="n">class_list</span> <span class="o">=</span> <span class="n">tkn</span><span class="o">.</span><span class="n">Token</span><span class="o">.</span><span class="n">all_subclasses</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">cls_obj</span> <span class="ow">in</span> <span class="n">class_list</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">cls_obj</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="n">token_class_name</span><span class="p">:</span>
                        <span class="n">token_class</span> <span class="o">=</span> <span class="n">cls_obj</span>
                <span class="n">token_class</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>  <span class="c1"># Create token</span>
        <span class="n">board</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">send_event_to_containers</span><span class="p">(</span><span class="s2">"Loaded from db"</span><span class="p">,</span> <span class="n">board</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">board</span></div>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">all_subclasses</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">rec_all_subs</span><span class="p">(</span><span class="n">base_cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">set</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">subclasses</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">set</span><span class="p">(</span><span class="n">base_cls</span><span class="o">.</span><span class="n">__subclasses__</span><span class="p">())</span><span class="o">.</span><span class="n">union</span><span class="p">(</span>
                    <span class="p">[</span><span class="n">s</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">base_cls</span><span class="o">.</span><span class="n">__subclasses__</span><span class="p">()</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">rec_all_subs</span><span class="p">(</span><span class="n">c</span><span class="p">)])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">subclasses</span>

        <span class="k">return</span> <span class="n">rec_all_subs</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">"</span><span class="si">{0}</span><span class="s2"> with </span><span class="si">{1}</span><span class="s2"> columns and </span><span class="si">{2}</span><span class="s2"> rows"</span> \
            <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_act_all</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tokens</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">board</span><span class="p">:</span>  <span class="c1"># is on board</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_handle_act_event</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
        <span class="n">method</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">"act"</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">method</span><span class="p">:</span>
            <span class="n">method</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">container_width</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="sd">"""</span>
<span class="sd">        The width of the container</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_repaint_all</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_container_width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">tile_size</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">columns</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">tile_margin</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_container_width</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">container_height</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="sd">"""</span>
<span class="sd">        The height of the container</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_repaint_all</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_container_height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rows</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">tile_size</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rows</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">tile_margin</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_container_height</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">speed</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="sd">"""</span>
<span class="sd">        How often are events and game logic processed?</span>
<span class="sd">        </span>
<span class="sd">        The game logic can be called more often or less often independently from board.fps</span>

<span class="sd">        Examples:</span>

<span class="sd">        .. code-block:: python</span>
<span class="sd">        </span>
<span class="sd">            board.speed = 10</span>
<span class="sd">            board.fps = 24</span>
<span class="sd">            def act(self):</span>
<span class="sd">                nonlocal i</span>
<span class="sd">                i = i + 1</span>
<span class="sd">                print(board.frame, i)</span>
<span class="sd">                if board.frame == 120:</span>
<span class="sd">                    test_instance.assertEqual(i, 13)</span>
<span class="sd">                    test_instance.assertEqual(board.frame, 120)</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fps</span>

    <span class="nd">@speed</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">speed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fps</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">fps</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="sd">"""</span>
<span class="sd">        Frames per second shown on the screen.</span>
<span class="sd">        </span>
<span class="sd">        This controls how often the screen is redrawn. However, the game logic </span>
<span class="sd">        can be called more often or less often independently of this with board.speed.</span>

<span class="sd">        Examples:</span>

<span class="sd">        .. code-block:: python</span>
<span class="sd">        </span>
<span class="sd">            board.speed = 10</span>
<span class="sd">            board.fps = 24</span>
<span class="sd">            def act(self):</span>
<span class="sd">                nonlocal i</span>
<span class="sd">                i = i + 1</span>
<span class="sd">                print(board.frame, i)</span>
<span class="sd">                if board.frame == 120:</span>
<span class="sd">                    test_instance.assertEqual(i, 13)</span>
<span class="sd">                    test_instance.assertEqual(board.frame, 120)</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fps</span>

    <span class="nd">@fps</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">fps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fps</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">width</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="sd">"""</span>
<span class="sd">        See container_width</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">container_width</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">height</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="sd">"""</span>
<span class="sd">        See container_height</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">container_height</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">window</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">app</span><span class="o">.</span><span class="n">App</span><span class="p">:</span>
        <span class="sd">"""</span>
<span class="sd">        Gets the parent window</span>

<span class="sd">        Returns:</span>
<span class="sd">            The window</span>

<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_window</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">rows</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="sd">"""</span>
<span class="sd">        The number of rows</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rows</span>

    <span class="nd">@rows</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">rows</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rows</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">dirty</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_repaint_all</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">columns</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="sd">"""</span>
<span class="sd">        The number of columns</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_columns</span>

    <span class="nd">@columns</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">columns</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_columns</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">dirty</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_repaint_all</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">tile_size</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="sd">"""</span>
<span class="sd">        The number of columns</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_size</span>

    <span class="nd">@tile_size</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">tile_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tile_size</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">dirty</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_repaint_all</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">tile_margin</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="sd">"""</span>
<span class="sd">        The number of columns</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_margin</span>

    <span class="nd">@tile_margin</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">tile_margin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tile_margin</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">dirty</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_repaint_all</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">tokens</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pygame</span><span class="o">.</span><span class="n">sprite</span><span class="o">.</span><span class="n">LayeredDirty</span><span class="p">:</span>
        <span class="sd">"""</span>
<span class="sd">        A list of all tokens registered to the grid.</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tokens</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">class_name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>


<div class="viewcode-block" id="Board.add_background"><a class="viewcode-back" href="../../../api/board.html#miniworldmaker.boards.board.Board.add_background">[docs]</a>    <span class="k">def</span> <span class="nf">add_background</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">background</span><span class="o">.</span><span class="n">Background</span><span class="p">:</span>
        <span class="sd">"""</span>
<span class="sd">        Adds a new background to the board</span>

<span class="sd">        Args:</span>
<span class="sd">            source: The path to the first image of the background or a color</span>

<span class="sd">        Examples:</span>

<span class="sd">            Multiple Backgrounds:</span>

<span class="sd">            .. code-block:: python</span>

<span class="sd">                board = miniworldmaker.TiledBoard()</span>
<span class="sd">                ...</span>
<span class="sd">                board.add_background("images/soccer_green.jpg")</span>
<span class="sd">                board.add_background("images/space.jpg")</span>

<span class="sd">        Returns: </span>
<span class="sd">            The new created background.</span>



<span class="sd">        """</span>
        <span class="n">new_background</span> <span class="o">=</span> <span class="n">background</span><span class="o">.</span><span class="n">Background</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">source</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
            <span class="n">new_background</span><span class="o">.</span><span class="n">add_image</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">source</span><span class="p">)</span> <span class="o">==</span> <span class="nb">tuple</span><span class="p">:</span>
            <span class="n">new_background</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">background</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">background</span> <span class="o">=</span> <span class="n">new_background</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_all_costumes</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_background</span><span class="p">()</span>
            <span class="n">new_background</span><span class="o">.</span><span class="n">orientation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">background</span><span class="o">.</span><span class="n">orientation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">backgrounds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_background</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">new_background</span></div>

    <span class="k">def</span> <span class="nf">add_to_board</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="n">position</span><span class="p">:</span> <span class="n">board_position</span><span class="o">.</span><span class="n">BoardPosition</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Adds an actor to the board.</span>
<span class="sd">        Is called in __init__-Method if position is set.</span>

<span class="sd">        Args:</span>
<span class="sd">            board: The board, the actor should be added</span>
<span class="sd">            position: The position on the board where the actor should be added.</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tokens</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
        <span class="n">token</span><span class="o">.</span><span class="n">dirty</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">init</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">UnboundLocalError</span><span class="p">(</span><span class="s2">"super().__init__() was not called"</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_register_physics_collision_handler</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
        <span class="c1"># Board Connectors are added in subclasses</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_board_connector</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">position</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_add_board_connector</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="n">position</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
            <span class="s2">"You can't use class Board - You must use a specific class e.g. PixelBoard, TiledBoard or PhysicsBoard"</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">blit_surface_to_window_surface</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">window_surface</span><span class="o">.</span><span class="n">blit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">surface</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_colors_at_position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">tuple</span><span class="p">,</span> <span class="n">board_position</span><span class="o">.</span><span class="n">BoardPosition</span><span class="p">]):</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">position</span><span class="p">)</span> <span class="o">==</span> <span class="nb">tuple</span><span class="p">:</span>
            <span class="n">position</span> <span class="o">=</span> <span class="n">board_position</span><span class="o">.</span><span class="n">BoardPosition</span><span class="p">(</span><span class="n">position</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">position</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">position</span><span class="o">.</span><span class="n">color</span><span class="p">()</span>

<div class="viewcode-block" id="Board.get_colors_at_line"><a class="viewcode-back" href="../../../api/board.html#miniworldmaker.boards.board.Board.get_colors_at_line">[docs]</a>    <span class="k">def</span> <span class="nf">get_colors_at_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Gets all colors in a line. A line is a list of board_positions</span>

<span class="sd">        Args:</span>
<span class="sd">            line: the line</span>

<span class="sd">        Returns: </span>
<span class="sd">            A list of all colors found at the line</span>

<span class="sd">        """</span>
        <span class="n">colors</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span> <span class="o">==</span> <span class="nb">tuple</span><span class="p">:</span>
                <span class="n">pos</span> <span class="o">=</span> <span class="n">board_position</span><span class="o">.</span><span class="n">BoardPosition</span><span class="o">.</span><span class="n">from_tuple</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>
            <span class="n">color_at_pos</span> <span class="o">=</span> <span class="n">pos</span><span class="o">.</span><span class="n">color</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">color_at_pos</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">colors</span><span class="p">:</span>
                <span class="n">colors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">color_at_pos</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">colors</span></div>

    <span class="k">def</span> <span class="nf">get_color_at_rect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rect</span><span class="p">:</span> <span class="n">board_rect</span><span class="o">.</span><span class="n">BoardRect</span><span class="p">,</span> <span class="n">directions</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">rect</span><span class="o">.</span><span class="n">colors</span><span class="p">()</span>

<div class="viewcode-block" id="Board.get_tokens_by_pixel"><a class="viewcode-back" href="../../../api/board.html#miniworldmaker.boards.board.Board.get_tokens_by_pixel">[docs]</a>    <span class="k">def</span> <span class="nf">get_tokens_by_pixel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pixel</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
        <span class="sd">"""Gets all tokens by Pixel.</span>

<span class="sd">        Args:</span>
<span class="sd">            pixel: the pixel-coordinates</span>

<span class="sd">        Returns:</span>
<span class="sd">            A list of tokens</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; position = board.get_mouse_position()</span>
<span class="sd">            &gt;&gt;&gt; tokens = board.get_tokens_by_pixel(position)</span>

<span class="sd">        """</span>
        <span class="c1"># token = []</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">token</span> <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tokens</span> <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">collidepoint</span><span class="p">(</span><span class="n">pixel</span><span class="p">)]</span></div>
        <span class="c1"># for actor in self.tokens:</span>
        <span class="c1">#    if actor.rect.collidepoint(pixel):</span>
        <span class="c1">#        token.append(Token)</span>
        <span class="c1"># return token</span>

<div class="viewcode-block" id="Board.get_tokens_at_rect"><a class="viewcode-back" href="../../../api/board.html#miniworldmaker.boards.board.Board.get_tokens_at_rect">[docs]</a>    <span class="k">def</span> <span class="nf">get_tokens_at_rect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rect</span><span class="p">:</span> <span class="n">pygame</span><span class="o">.</span><span class="n">Rect</span><span class="p">,</span> <span class="n">singleitem</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">token_type</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span>
        <span class="n">tkn</span><span class="o">.</span><span class="n">Token</span><span class="p">,</span> <span class="nb">list</span><span class="p">]:</span>
        <span class="sd">"""</span>
<span class="sd">        Gets all Tokens which are colliding with a given rect.</span>

<span class="sd">        Args:</span>
<span class="sd">            rect: The rect</span>
<span class="sd">            singleitem: Should the method return a single token (faster) or all tokens at rect (slower)</span>
<span class="sd">            exclude: Exclude a token</span>
<span class="sd">            token_type: Filter return values by token type</span>

<span class="sd">        Returns: A single token or a list of tokens at rect</span>

<span class="sd">        """</span>
        <span class="k">pass</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">image</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pygame</span><span class="o">.</span><span class="n">Surface</span><span class="p">:</span>
        <span class="sd">"""</span>
<span class="sd">        The current displayed image</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">background</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">background</span><span class="o">.</span><span class="n">image</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_image</span>

<div class="viewcode-block" id="Board.remove_tokens_from_rect"><a class="viewcode-back" href="../../../api/board.html#miniworldmaker.boards.board.Board.remove_tokens_from_rect">[docs]</a>    <span class="k">def</span> <span class="nf">remove_tokens_from_rect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rect</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">tuple</span><span class="p">,</span> <span class="n">pygame</span><span class="o">.</span><span class="n">Rect</span><span class="p">],</span> <span class="n">token</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">"""Removes all tokens in an area</span>

<span class="sd">        Args:</span>
<span class="sd">            rect: A rectangle or a tuple (which is automated converted to a rectangle with tile_size</span>
<span class="sd">            token: The class of the tokens which should be removed</span>
<span class="sd">            exclude: A token which should not be removed e.g. the actor itself</span>

<span class="sd">        Returns: all tokens in the area</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">rect</span><span class="p">)</span> <span class="o">==</span> <span class="nb">tuple</span><span class="p">:</span>
            <span class="n">rect</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">Rect</span><span class="p">(</span><span class="n">rect</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">rect</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">tokens</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_tokens_at_rect</span><span class="p">(</span><span class="n">rect</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">token</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="p">[</span><span class="n">token</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span> <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">Board</span><span class="o">.</span><span class="n">filter_actor_list</span><span class="p">(</span><span class="n">tokens</span><span class="p">,</span> <span class="n">token</span><span class="p">)]</span></div>

    <span class="k">def</span> <span class="nf">switch_board</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Board</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">send_event_to_containers</span><span class="p">(</span><span class="s2">"switch_board"</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="p">,</span> <span class="n">Board</span><span class="p">,</span> <span class="n">size</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_running</span> <span class="o">=</span> <span class="kc">True</span>

<div class="viewcode-block" id="Board.stop"><a class="viewcode-back" href="../../../api/board.html#miniworldmaker.boards.board.Board.stop">[docs]</a>    <span class="k">def</span> <span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frames</span> <span class="o">=</span> <span class="mi">1</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        stops the board in n-frames</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="n">frames</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">is_running</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">timer</span><span class="o">.</span><span class="n">ActionTimer</span><span class="p">(</span><span class="n">frames</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">clean</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tokens</span><span class="p">:</span>
            <span class="n">token</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>

<div class="viewcode-block" id="Board.reset"><a class="viewcode-back" href="../../../api/board.html#miniworldmaker.boards.board.Board.reset">[docs]</a>    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""Resets the board</span>
<span class="sd">        Creates a new board with init-function - recreates all tokens and actors on the board.</span>

<span class="sd">        Examples:</span>

<span class="sd">            Restarts flappy the bird game after collision with pipe:</span>

<span class="sd">            &gt;&gt;&gt; def on_sensing_collision_with_pipe(self, other, info):</span>
<span class="sd">            &gt;&gt;&gt;    self.board.is_running = False</span>
<span class="sd">            &gt;&gt;&gt;    self.board.reset()</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">send_event_to_containers</span><span class="p">(</span><span class="s2">"reset"</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">repaint</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">background</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_repaint_all</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">background</span><span class="o">.</span><span class="n">call_all_actions</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">surface</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">Surface</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">container_width</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">container_height</span><span class="p">))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">surface</span><span class="o">.</span><span class="n">blit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">surface</span><span class="o">.</span><span class="n">get_rect</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tokens</span><span class="o">.</span><span class="n">clear</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">surface</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">)</span>
            <span class="n">repaint_rects</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tokens</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">surface</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">repaint_areas</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">repaint_rects</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_repaint_all</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">repaint_areas</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_repaint_all</span> <span class="o">=</span> <span class="kc">False</span>

<div class="viewcode-block" id="Board.run"><a class="viewcode-back" href="../../../api/board.html#miniworldmaker.boards.board.Board.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fullscreen</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        The method show() should always called at the end of your program.</span>
<span class="sd">        It starts the mainloop.</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; my_board = Board() # or a subclass of Board</span>
<span class="sd">            &gt;&gt;&gt; my_board.show()</span>

<span class="sd">        """</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_setup</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">"setup"</span><span class="p">)</span> <span class="ow">and</span> <span class="n">callable</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">"setup"</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">send_event_to_containers</span><span class="p">(</span><span class="s2">"setup"</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">"on_setup"</span><span class="p">)</span> <span class="ow">and</span> <span class="n">callable</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">"on_setup"</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">send_event_to_containers</span><span class="p">(</span><span class="s2">"setup"</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">,</span> <span class="n">full_screen</span><span class="o">=</span><span class="n">fullscreen</span><span class="p">)</span></div>

<div class="viewcode-block" id="Board.switch_background"><a class="viewcode-back" href="../../../api/board.html#miniworldmaker.boards.board.Board.switch_background">[docs]</a>    <span class="k">def</span> <span class="nf">switch_background</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">background</span><span class="o">.</span><span class="n">Background</span><span class="p">:</span>
        <span class="sd">"""Switches the background</span>

<span class="sd">        Args:</span>
<span class="sd">            index: The index of the new costume. If index=-1, the next costume will be selected</span>

<span class="sd">        Returns: </span>
<span class="sd">            The new costume</span>

<span class="sd">        """</span>
        <span class="k">if</span> <span class="n">index</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">backgrounds</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">background</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">backgrounds</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">index</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">background</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">backgrounds</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">background</span><span class="o">.</span><span class="n">dirty</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">background_changed</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_repaint_all</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="p">[</span><span class="n">token</span><span class="o">.</span><span class="n">set_dirty</span><span class="p">()</span> <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tokens</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">background</span></div>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># This is the board-mainloop()</span>
        <span class="c1"># Called in miniworldwindow.update as ct.update()</span>
        <span class="c1"># Event handling is in miniworldwindow and is called before update().</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_running</span><span class="p">:</span>
            <span class="c1"># Acting for all actors</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">speed</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_act_all</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_handle_all_collisions</span><span class="p">()</span>
            <span class="c1"># run animations</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_all_costumes</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_background</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_tick_timed_objects</span><span class="p">()</span>
            <span class="c1"># If there are physic objects, run a physics simulation step</span>
            <span class="k">if</span> <span class="n">physicsengine</span><span class="o">.</span><span class="n">PhysicsProperty</span><span class="o">.</span><span class="n">count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">physics_tokens</span> <span class="o">=</span> <span class="p">[</span><span class="n">token</span> <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tokens</span> <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">physics</span> <span class="ow">and</span> <span class="n">token</span><span class="o">.</span><span class="n">physics</span><span class="o">.</span><span class="n">started</span><span class="p">]</span>
                <span class="n">physics</span><span class="o">.</span><span class="n">PhysicsProperty</span><span class="o">.</span><span class="n">simulation</span><span class="p">(</span><span class="n">physics_tokens</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clock</span><span class="o">.</span><span class="n">tick</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fps</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_executed_events</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_update_all_costumes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="p">[</span><span class="n">token</span><span class="o">.</span><span class="n">costume</span><span class="o">.</span><span class="n">update</span><span class="p">()</span> <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tokens</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_update_background</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">background</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">background</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_tick_timed_objects</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="p">[</span><span class="n">obj</span><span class="o">.</span><span class="n">tick</span><span class="p">()</span> <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">timed_objects</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">handle_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Event handling</span>

<span class="sd">        Args:</span>
<span class="sd">            event (str): The event which was thrown, e.g. "key_up", "act", "reset", ...</span>
<span class="sd">            data: The data of the event (e.g. ["S","s"], (155,3), ...</span>
<span class="sd">        """</span>
        <span class="c1"># Call specific event handlers ("on_mouse_left", "on_mouse_right", ... for tokens</span>
        <span class="k">if</span> <span class="n">event</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_executed_events</span><span class="p">:</span>  <span class="c1"># events shouldn't be called more than once per tick</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_executed_events</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
            <span class="kn">from</span> <span class="nn">miniworldmaker.tokens</span> <span class="kn">import</span> <span class="n">token</span>
            <span class="n">token_classes</span> <span class="o">=</span> <span class="n">token</span><span class="o">.</span><span class="n">Token</span><span class="o">.</span><span class="n">all_subclasses</span><span class="p">()</span>
            <span class="n">token_classes</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">Token</span><span class="p">)</span>
            <span class="n">all_objects</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tokens</span><span class="o">.</span><span class="n">sprites</span><span class="p">())</span>
            <span class="n">all_objects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">a_object</span> <span class="ow">in</span> <span class="n">all_objects</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">event</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">"reset"</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_handle_reset_event</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">event</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">"setup"</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_handle_setup_event</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">event</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">"switch_board"</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_handle_switch_board_event</span><span class="p">(</span><span class="o">*</span><span class="n">data</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">event</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">"key_down"</span><span class="p">,</span> <span class="s2">"key_pressed"</span><span class="p">,</span> <span class="s2">"key_down"</span><span class="p">,</span> <span class="s2">"key_up"</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_handle_key_event</span><span class="p">(</span><span class="n">a_object</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">event</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">"mouse_left"</span><span class="p">,</span> <span class="s2">"mouse_right"</span><span class="p">,</span> <span class="s2">"mouse_motion"</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_handle_mouse_event</span><span class="p">(</span><span class="n">a_object</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">event</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">"clicked_left"</span><span class="p">,</span> <span class="s2">"clicked_right"</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_handle_mouse_token_event</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">event</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">"message"</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_handle_message_event</span><span class="p">(</span><span class="n">a_object</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">event</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">"button_pressed"</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_handle_button_event</span><span class="p">(</span><span class="n">a_object</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">event</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">registered_event_handlers</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="c1"># calls registered event handlers of board</span>
                <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">registered_event_handlers</span><span class="p">[</span><span class="n">event</span><span class="p">]()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">registered_event_handlers</span><span class="p">[</span><span class="n">event</span><span class="p">](</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">"Wrong number of arguments for "</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">registered_event_handlers</span><span class="p">[</span><span class="n">event</span><span class="p">]),</span>
                                        <span class="s2">" with Arguments "</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_event</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a_object</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        If a (token-)object has method this returns the method by a given name</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">a_object</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">callable</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">a_object</span><span class="p">,</span> <span class="n">name</span><span class="p">)):</span>
                <span class="n">_method</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">a_object</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
                <span class="n">_bound_method</span> <span class="o">=</span> <span class="n">_method</span><span class="o">.</span><span class="fm">__get__</span><span class="p">(</span><span class="n">a_object</span><span class="p">,</span> <span class="n">a_object</span><span class="o">.</span><span class="vm">__class__</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">_bound_method</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_call_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">receiver</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
        <span class="n">sig</span> <span class="o">=</span> <span class="n">signature</span><span class="p">(</span><span class="n">method</span><span class="p">)</span>
        <span class="c1"># Don't call method if tokens are already removed:</span>
        <span class="k">if</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">receiver</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="n">tkn</span><span class="o">.</span><span class="n">Token</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">receiver</span><span class="o">.</span><span class="n">board</span><span class="p">:</span>
                <span class="k">return</span>
        <span class="k">if</span> <span class="n">args</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">method</span><span class="p">()</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">sig</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
            <span class="n">method</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">info</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getframeinfo</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">())</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">"Wrong number of arguments for "</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">method</span><span class="p">)</span> <span class="o">+</span> <span class="s2">" in , got "</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                    <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">))</span> <span class="o">+</span> <span class="s2">" but should be "</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                    <span class="nb">len</span><span class="p">(</span><span class="n">sig</span><span class="o">.</span><span class="n">parameters</span><span class="p">))</span> <span class="o">+</span> <span class="s2">"; "</span>
                <span class="s2">"File:"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">info</span><span class="o">.</span><span class="n">filename</span><span class="p">),</span> <span class="s2">"; Method: "</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">method</span><span class="p">)</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_handle_key_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">receiver</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="c1"># any key down?</span>
        <span class="n">method</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_method</span><span class="p">(</span><span class="n">receiver</span><span class="p">,</span> <span class="s2">"on_"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">event</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">method</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_call_method</span><span class="p">(</span><span class="n">receiver</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="p">[</span><span class="n">data</span><span class="p">])</span>
        <span class="c1"># specific key down?</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="n">key</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                <span class="n">method</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_method</span><span class="p">(</span><span class="n">receiver</span><span class="p">,</span> <span class="s2">"on_"</span> <span class="o">+</span> <span class="n">event</span> <span class="o">+</span> <span class="s2">"_"</span> <span class="o">+</span> <span class="n">key</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">method</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_call_method</span><span class="p">(</span><span class="n">receiver</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_handle_mouse_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">receiver</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="c1"># any key down?</span>
        <span class="n">method_name</span> <span class="o">=</span> <span class="s2">"on_"</span> <span class="o">+</span> <span class="n">event</span>
        <span class="n">method</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_method</span><span class="p">(</span><span class="n">receiver</span><span class="p">,</span> <span class="n">method_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">method</span><span class="p">:</span>
            <span class="n">sig</span> <span class="o">=</span> <span class="n">signature</span><span class="p">(</span><span class="n">method</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sig</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">method</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_handle_mouse_token_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="c1"># any key down?</span>
        <span class="n">token</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">position</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">method_name</span> <span class="o">=</span> <span class="s2">"on_"</span> <span class="o">+</span> <span class="n">event</span>
        <span class="n">method</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_method</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">method_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">method</span><span class="p">:</span>
            <span class="n">sig</span> <span class="o">=</span> <span class="n">signature</span><span class="p">(</span><span class="n">method</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sig</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">method</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">tokens</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_tokens_by_pixel</span><span class="p">(</span><span class="n">position</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">tokens</span><span class="p">:</span>
            <span class="n">method</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_method</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">method_name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">method</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_call_method</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="p">[</span><span class="n">position</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">_handle_setup_event</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_setup</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">"setup"</span><span class="p">)</span> <span class="ow">and</span> <span class="n">callable</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">"setup"</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">setup</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_is_setup</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">"on_setup"</span><span class="p">)</span> <span class="ow">and</span> <span class="n">callable</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">"on_setup"</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">on_setup</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_is_setup</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">_handle_reset_event</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">event_queue</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tokens</span><span class="p">:</span>
            <span class="n">token</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">board</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">board</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
        <span class="n">board</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">board</span>
        <span class="n">board</span><span class="o">.</span><span class="n">event_queue</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="k">del</span> <span class="bp">self</span>
        <span class="k">return</span> <span class="n">board</span>

    <span class="k">def</span> <span class="nf">_handle_switch_board_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">old_board</span><span class="p">,</span> <span class="n">Board</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">event_queue</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tokens</span><span class="p">:</span>
            <span class="n">token</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">board</span> <span class="o">=</span> <span class="n">Board</span><span class="p">(</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">board</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">board</span>
        <span class="n">board</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
        <span class="n">board</span><span class="o">.</span><span class="n">event_queue</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="k">del</span> <span class="bp">self</span>
        <span class="k">return</span> <span class="n">board</span>

    <span class="k">def</span> <span class="nf">_handle_act_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">receiver</span><span class="p">):</span>
        <span class="c1"># any key down?</span>
        <span class="n">method</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_method</span><span class="p">(</span><span class="n">receiver</span><span class="p">,</span> <span class="s2">"act"</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">method</span><span class="p">:</span>
            <span class="n">sig</span> <span class="o">=</span> <span class="n">signature</span><span class="p">(</span><span class="n">method</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sig</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">method</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">"Wrong number of arguments for act-Method (should be: 0)"</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_handle_button_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">receiver</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="c1"># any key down?</span>
        <span class="n">method</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_method</span><span class="p">(</span><span class="n">receiver</span><span class="p">,</span> <span class="s2">"on_button_pressed"</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">method</span><span class="p">:</span>
            <span class="n">sig</span> <span class="o">=</span> <span class="n">signature</span><span class="p">(</span><span class="n">method</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sig</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">method</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_handle_message_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">receiver</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="c1"># any key down?</span>
        <span class="n">method</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_method</span><span class="p">(</span><span class="n">receiver</span><span class="p">,</span> <span class="s2">"on_message"</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">method</span><span class="p">:</span>
            <span class="n">sig</span> <span class="o">=</span> <span class="n">signature</span><span class="p">(</span><span class="n">method</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sig</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">method</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_handle_all_collisions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tokens</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_handle_collision_with_tokens</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_handle_collision_with_borders</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_handle_on_board</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_handle_collision_with_tokens</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">token</span><span class="p">):</span>
        <span class="n">members</span> <span class="o">=</span> <span class="nb">dir</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
        <span class="n">found_tokens</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">token_type</span> <span class="ow">in</span> <span class="p">[</span><span class="n">member</span><span class="p">[</span><span class="mi">11</span><span class="p">:]</span> <span class="k">for</span> <span class="n">member</span> <span class="ow">in</span> <span class="n">members</span> <span class="k">if</span> <span class="n">member</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">"on_sensing_"</span><span class="p">)]:</span>
            <span class="n">tokens_for_token_type</span> <span class="o">=</span> <span class="n">token</span><span class="o">.</span><span class="n">sensing_tokens</span><span class="p">(</span><span class="n">token_type</span><span class="o">=</span><span class="n">token_type</span><span class="o">.</span><span class="n">capitalize</span><span class="p">())</span>
            <span class="k">for</span> <span class="n">found_token</span> <span class="ow">in</span> <span class="n">tokens_for_token_type</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">found_token</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">found_tokens</span><span class="p">:</span>
                    <span class="n">found_tokens</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">found_token</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">found_tokens</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">other_token</span> <span class="ow">in</span> <span class="n">found_tokens</span><span class="p">:</span>
                <span class="n">parents</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getmro</span><span class="p">(</span><span class="n">other_token</span><span class="o">.</span><span class="vm">__class__</span><span class="p">)</span>
                <span class="n">other_and_parents</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">parents</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">other_and_parents</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">other_class</span> <span class="ow">in</span> <span class="n">other_and_parents</span><span class="p">:</span>
                        <span class="n">method_name</span> <span class="o">=</span> <span class="p">(</span><span class="s1">'on_sensing_'</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">other_class</span><span class="o">.</span><span class="vm">__name__</span><span class="p">))</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                        <span class="n">method</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_method</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">method_name</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">method</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_call_method</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="p">[</span><span class="n">other_token</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">_handle_collision_with_borders</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">token</span><span class="p">):</span>
        <span class="n">border_methods_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"on_sensing_left_border"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_method</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="s2">"on_sensing_left_border"</span><span class="p">),</span>
                               <span class="s2">"on_sensing_right_border"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_method</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="s2">"on_sensing_right_border"</span><span class="p">),</span>
                               <span class="s2">"on_sensing_bottom_border"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_method</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="s2">"on_sensing_bottom_border"</span><span class="p">),</span>
                               <span class="s2">"on_sensing_top_border"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_method</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="s2">"on_sensing_top_border"</span><span class="p">),</span>
                               <span class="p">}</span>
        <span class="n">on_sensing_borders</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_method</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="s2">"on_sensing_borders"</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">on_sensing_borders</span> <span class="ow">or</span> <span class="p">[</span><span class="n">method</span> <span class="k">for</span> <span class="n">method</span> <span class="ow">in</span> <span class="n">border_methods_dict</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">if</span> <span class="n">method</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]:</span>
            <span class="n">sensed_borders</span> <span class="o">=</span> <span class="n">token</span><span class="o">.</span><span class="n">sensing_borders</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">sensed_borders</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">on_sensing_borders</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_call_method</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">on_sensing_borders</span><span class="p">,</span> <span class="p">[</span><span class="n">sensed_borders</span><span class="p">])</span>
                <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">border_methods_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">border_methods_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]:</span>
                        <span class="k">for</span> <span class="n">border</span> <span class="ow">in</span> <span class="n">sensed_borders</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">border</span> <span class="ow">in</span> <span class="n">key</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">_call_method</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">border_methods_dict</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="kc">None</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_handle_on_board</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a_object</span><span class="p">):</span>
        <span class="n">on_board_handler</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_method</span><span class="p">(</span><span class="n">a_object</span><span class="p">,</span> <span class="s1">'on_sensing_on_board'</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
        <span class="n">not_on_board_handler</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_method</span><span class="p">(</span><span class="n">a_object</span><span class="p">,</span> <span class="s1">'on_sensing_not_on_board'</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">on_board_handler</span> <span class="ow">or</span> <span class="n">not_on_board_handler</span><span class="p">:</span>
            <span class="n">is_on_board</span> <span class="o">=</span> <span class="n">a_object</span><span class="o">.</span><span class="n">sensing_on_board</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">is_on_board</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">on_board_handler</span><span class="p">:</span>
                    <span class="n">on_board_handler</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">not_on_board_handler</span><span class="p">:</span>
                    <span class="n">not_on_board_handler</span><span class="p">()</span>

<div class="viewcode-block" id="Board.save_to_db"><a class="viewcode-back" href="../../../api/board.html#miniworldmaker.boards.board.Board.save_to_db">[docs]</a>    <span class="k">def</span> <span class="nf">save_to_db</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Saves the current board an all actors to database.</span>
<span class="sd">        The file is stored as db file and can be opened with sqlite.</span>

<span class="sd">        Args:</span>
<span class="sd">            file: The file as relative location</span>

<span class="sd">        Returns:</span>

<span class="sd">        """</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">file</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
        <span class="n">db</span> <span class="o">=</span> <span class="n">db_manager</span><span class="o">.</span><span class="n">DBManager</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
        <span class="n">query_actors</span> <span class="o">=</span> <span class="s2">"""     CREATE TABLE `token` (</span>
<span class="s2">                        `token_id`			INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT UNIQUE,</span>
<span class="s2">                        `column`		INTEGER,</span>
<span class="s2">                        `row`			INTEGER,</span>
<span class="s2">                        `token_class`	TEXT,</span>
<span class="s2">                        `parent_class`  TEXT</span>
<span class="s2">                        );</span>
<span class="s2">                        """</span>
        <span class="n">query_board</span> <span class="o">=</span> <span class="s2">"""     CREATE TABLE `board` (</span>
<span class="s2">                        `tile_size`		INTEGER,</span>
<span class="s2">                        `rows`			INTEGER,</span>
<span class="s2">                        `columns`		INTEGER,</span>
<span class="s2">                        `tile_margin`	INTEGER,</span>
<span class="s2">                        `board_class`	TEXT</span>
<span class="s2">                        );</span>
<span class="s2">                        """</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">cursor</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query_actors</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query_board</span><span class="p">)</span>
        <span class="n">db</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tokens</span><span class="p">:</span>
            <span class="n">token_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"column"</span><span class="p">:</span> <span class="n">token</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                          <span class="s2">"row"</span><span class="p">:</span> <span class="n">token</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                          <span class="s2">"token_class"</span><span class="p">:</span> <span class="n">token</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">}</span>
            <span class="n">db</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">table</span><span class="o">=</span><span class="s2">"token"</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="n">token_dict</span><span class="p">)</span>
        <span class="n">board_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"rows"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">,</span>
                      <span class="s2">"columns"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span>
                      <span class="s2">"tile_margin"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tile_margin</span><span class="p">,</span>
                      <span class="s2">"tile_size"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tile_size</span><span class="p">,</span>
                      <span class="s2">"board_class"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">}</span>
        <span class="n">db</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">table</span><span class="o">=</span><span class="s2">"board"</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="n">board_dict</span><span class="p">)</span>
        <span class="n">db</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="n">db</span><span class="o">.</span><span class="n">close_connection</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">send_event_to_containers</span><span class="p">(</span><span class="s2">"Saved to db"</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">play_sound</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">"mp3"</span><span class="p">):</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="p">[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="s2">"wav"</span>
        <span class="k">if</span> <span class="n">path</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sound_effects</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sound_effects</span><span class="p">[</span><span class="n">path</span><span class="p">]</span><span class="o">.</span><span class="n">play</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">effect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">register_sound</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            <span class="n">effect</span><span class="o">.</span><span class="n">play</span><span class="p">()</span>

<div class="viewcode-block" id="Board.play_music"><a class="viewcode-back" href="../../../api/board.html#miniworldmaker.boards.board.Board.play_music">[docs]</a>    <span class="k">def</span> <span class="nf">play_music</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        plays a music by path</span>

<span class="sd">        Args:</span>
<span class="sd">            path: The path to the music</span>

<span class="sd">        Returns:</span>

<span class="sd">        """</span>
        <span class="n">pygame</span><span class="o">.</span><span class="n">mixer</span><span class="o">.</span><span class="n">music</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="n">pygame</span><span class="o">.</span><span class="n">mixer</span><span class="o">.</span><span class="n">music</span><span class="o">.</span><span class="n">play</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">find_colors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rect</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">)):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">background</span><span class="o">.</span><span class="n">count_pixels_by_color</span><span class="p">(</span><span class="n">rect</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">threshold</span><span class="p">)</span>

<div class="viewcode-block" id="Board.get_mouse_position"><a class="viewcode-back" href="../../../api/board.html#miniworldmaker.boards.board.Board.get_mouse_position">[docs]</a>    <span class="k">def</span> <span class="nf">get_mouse_position</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">board_position</span><span class="o">.</span><span class="n">BoardPosition</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
        <span class="sd">"""</span>
<span class="sd">        Gets the current mouse_position</span>

<span class="sd">        Returns:</span>
<span class="sd">            Returns the mouse position if mouse is on board. Returns "None" otherwise</span>

<span class="sd">        Examples:</span>
<span class="sd">            This example shows you how to use the mouse_position</span>

<span class="sd">            &gt;&gt;&gt; def act(self):</span>
<span class="sd">            &gt;&gt;&gt;     mouse = self.board.get_mouse_position()</span>
<span class="sd">            &gt;&gt;&gt;     if mouse:</span>
<span class="sd">            &gt;&gt;&gt;         self.point_towards_position(mouse)</span>

<span class="sd">        """</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="n">board_position</span><span class="o">.</span><span class="n">BoardPosition</span><span class="o">.</span><span class="n">from_pixel</span><span class="p">(</span><span class="n">pygame</span><span class="o">.</span><span class="n">mouse</span><span class="o">.</span><span class="n">get_pos</span><span class="p">())</span>
        <span class="n">clicked_container</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">get_container_by_pixel</span><span class="p">(</span><span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">clicked_container</span> <span class="o">==</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">pos</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span></div>

    <span class="k">def</span> <span class="nf">get_board_position_from_pixel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pixel</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">board_position</span><span class="o">.</span><span class="n">BoardPosition</span><span class="o">.</span><span class="n">from_pixel</span><span class="p">(</span><span class="n">pixel</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_update_event_handling</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tokens_with_eventhandler</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tokens</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">event_handler</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">registered_event_handlers_for_tokens</span><span class="p">[</span><span class="n">token</span><span class="o">.</span><span class="vm">__class__</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tokens_with_eventhandler</span><span class="p">[</span><span class="n">event_handler</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>

<div class="viewcode-block" id="Board.is_position_on_board"><a class="viewcode-back" href="../../../api/board.html#miniworldmaker.boards.board.Board.is_position_on_board">[docs]</a>    <span class="k">def</span> <span class="nf">is_position_on_board</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position</span><span class="p">:</span> <span class="n">board_position</span><span class="o">.</span><span class="n">BoardPosition</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">"""Tests if area or position is on board</span>

<span class="sd">        Args:</span>
<span class="sd">            position: A rectangle or a position</span>

<span class="sd">        Returns:</span>
<span class="sd">            True, if area is in grid</span>

<span class="sd">        """</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">position</span><span class="p">)</span> <span class="o">==</span> <span class="nb">tuple</span><span class="p">:</span>
            <span class="n">position</span> <span class="o">=</span> <span class="n">board_position</span><span class="o">.</span><span class="n">BoardPosition</span><span class="p">(</span><span class="n">position</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">position</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">position</span><span class="p">)</span> <span class="o">==</span> <span class="n">board_position</span><span class="o">.</span><span class="n">BoardPosition</span><span class="p">:</span>
            <span class="n">position</span> <span class="o">=</span> <span class="n">position</span><span class="o">.</span><span class="n">to_rect</span><span class="p">()</span>

        <span class="n">top_left_x</span><span class="p">,</span> <span class="n">top_left_y</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">top</span> <span class="o">=</span> <span class="n">position</span><span class="o">.</span><span class="n">topleft</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> \
                                             <span class="n">position</span><span class="o">.</span><span class="n">topleft</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> \
                                             <span class="n">position</span><span class="o">.</span><span class="n">right</span><span class="p">,</span> \
                                             <span class="n">position</span><span class="o">.</span><span class="n">top</span>
        <span class="k">if</span> <span class="n">top_left_x</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">top_left_y</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">position</span><span class="o">.</span><span class="n">right</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="ow">or</span> <span class="n">position</span><span class="o">.</span><span class="n">bottom</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="Board.register_sound"><a class="viewcode-back" href="../../../api/board.html#miniworldmaker.boards.board.Board.register_sound">[docs]</a>    <span class="k">def</span> <span class="nf">register_sound</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pygame</span><span class="o">.</span><span class="n">mixer</span><span class="o">.</span><span class="n">Sound</span><span class="p">:</span>
        <span class="sd">"""</span>
<span class="sd">        Registers a sound effect to board-sound effects library</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            path: The path to sound</span>

<span class="sd">        Returns: </span>
<span class="sd">            the sound</span>

<span class="sd">        """</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">effect</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">mixer</span><span class="o">.</span><span class="n">Sound</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sound_effects</span><span class="p">[</span><span class="n">path</span><span class="p">]</span> <span class="o">=</span> <span class="n">effect</span>
            <span class="k">return</span> <span class="n">effect</span>
        <span class="k">except</span> <span class="n">pygame</span><span class="o">.</span><span class="n">error</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">FileExistsError</span><span class="p">(</span><span class="s2">"File '</span><span class="si">{0}</span><span class="s2">' does not exist. Check your path to the sound."</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">path</span><span class="p">))</span></div>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_get_token_class_by_name</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Board</span><span class="o">.</span><span class="n">token_classes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_update_token_subclasses</span><span class="p">():</span>
        <span class="sd">"""</span>
<span class="sd">        Returns a dict with class_name-&gt;class</span>
<span class="sd">        updat</span>
<span class="sd">        Returns:</span>

<span class="sd">        """</span>
        <span class="n">token_subclasses</span> <span class="o">=</span> <span class="n">tkn</span><span class="o">.</span><span class="n">Token</span><span class="o">.</span><span class="n">all_subclasses</span><span class="p">()</span>
        <span class="n">token_subclasses</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">tkn</span><span class="o">.</span><span class="n">Token</span><span class="p">)</span>
        <span class="k">for</span> <span class="bp">cls</span> <span class="ow">in</span> <span class="n">token_subclasses</span><span class="p">:</span>
            <span class="n">Board</span><span class="o">.</span><span class="n">token_classes</span><span class="p">[</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="p">]</span> <span class="o">=</span> <span class="bp">cls</span>
            <span class="k">if</span> <span class="bp">cls</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">Board</span><span class="o">.</span><span class="n">token_class_ids</span><span class="p">:</span>
                <span class="bp">cls</span><span class="o">.</span><span class="n">class_id</span> <span class="o">=</span> <span class="n">Board</span><span class="o">.</span><span class="n">token_class_id_counter</span>
                <span class="n">Board</span><span class="o">.</span><span class="n">token_class_ids</span><span class="p">[</span><span class="bp">cls</span><span class="p">]</span> <span class="o">=</span> <span class="n">Board</span><span class="o">.</span><span class="n">token_class_id_counter</span>
                <span class="n">Board</span><span class="o">.</span><span class="n">token_class_id_counter</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">Board</span><span class="o">.</span><span class="n">token_classes</span>

    <span class="k">def</span> <span class="nf">_register_physics_collision_handler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">token</span><span class="p">):</span>

        <span class="k">def</span> <span class="nf">add_physics_collision_handler</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">other_class</span><span class="p">,</span> <span class="n">method</span><span class="p">):</span>
            <span class="n">handler</span> <span class="o">=</span> <span class="n">physics</span><span class="o">.</span><span class="n">PhysicsProperty</span><span class="o">.</span><span class="n">space</span><span class="o">.</span><span class="n">add_collision_handler</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">class_id</span><span class="p">,</span>
                                                                        <span class="n">other_class</span><span class="o">.</span><span class="n">class_id</span><span class="p">)</span>
            <span class="n">handler</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">"method"</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">method</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">method</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">Board</span><span class="o">.</span><span class="n">begin_prefix</span><span class="p">):</span>
                <span class="n">handler</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">"type"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"begin"</span>
                <span class="n">handler</span><span class="o">.</span><span class="n">begin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_physics_collision_handler</span>
            <span class="k">elif</span> <span class="n">method</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">Board</span><span class="o">.</span><span class="n">separate_prefix</span><span class="p">):</span>
                <span class="n">handler</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">"type"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"separate"</span>
                <span class="n">handler</span><span class="o">.</span><span class="n">separate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_physics_collision_handler</span>

        <span class="n">Board</span><span class="o">.</span><span class="n">_update_token_subclasses</span><span class="p">()</span>
        <span class="n">method_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">func</span> <span class="k">for</span> <span class="n">func</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">token</span><span class="p">)</span> <span class="k">if</span>
                       <span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">Board</span><span class="o">.</span><span class="n">begin_prefix</span><span class="p">)</span> <span class="ow">or</span> <span class="n">func</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">Board</span><span class="o">.</span><span class="n">separate_prefix</span><span class="p">))</span>
                       <span class="ow">and</span>
                       <span class="n">callable</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">func</span><span class="p">))]</span>
        <span class="k">for</span> <span class="n">method_name</span> <span class="ow">in</span> <span class="n">method_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">method_name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">Board</span><span class="o">.</span><span class="n">begin_prefix</span><span class="p">):</span>
                <span class="n">other_class_name</span> <span class="o">=</span> <span class="n">method_name</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">Board</span><span class="o">.</span><span class="n">begin_prefix</span><span class="p">):]</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span>
            <span class="k">elif</span> <span class="n">method_name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">Board</span><span class="o">.</span><span class="n">separate_prefix</span><span class="p">):</span>
                <span class="n">other_class_name</span> <span class="o">=</span> <span class="n">method_name</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">Board</span><span class="o">.</span><span class="n">separate_prefix</span><span class="p">):]</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span>
            <span class="n">other_class</span> <span class="o">=</span> <span class="n">Board</span><span class="o">.</span><span class="n">_get_token_class_by_name</span><span class="p">(</span><span class="n">other_class_name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">other_class</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">child_classes</span> <span class="o">=</span> <span class="n">other_class</span><span class="o">.</span><span class="n">all_subclasses</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">child_class</span> <span class="ow">in</span> <span class="n">child_classes</span><span class="p">:</span>
                    <span class="n">add_physics_collision_handler</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">child_class</span><span class="p">,</span> <span class="n">method_name</span><span class="p">)</span>
                <span class="n">add_physics_collision_handler</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">other_class</span><span class="p">,</span> <span class="n">method_name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_physics_collision_handler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arbiter</span><span class="p">,</span> <span class="n">space</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="n">rvalue</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">collision</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="n">other_class</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">arbiter</span><span class="o">.</span><span class="n">shapes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">token</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">rvalue</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pass_physics_collision_to_tokens</span><span class="p">(</span><span class="n">arbiter</span><span class="p">,</span> <span class="n">space</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s2">"type"</span><span class="p">]</span> <span class="o">==</span> <span class="s2">"begin"</span><span class="p">:</span>
            <span class="n">method</span> <span class="o">=</span> <span class="s2">"on_touching_"</span> <span class="o">+</span> <span class="n">other_class</span>
            <span class="n">method</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_method</span><span class="p">(</span><span class="n">arbiter</span><span class="o">.</span><span class="n">shapes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">token</span><span class="p">,</span> <span class="n">method</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">method</span> <span class="ow">and</span> <span class="n">callable</span><span class="p">(</span><span class="n">method</span><span class="p">):</span>
                <span class="n">rvalue</span> <span class="o">=</span> <span class="n">method</span><span class="p">(</span><span class="n">arbiter</span><span class="o">.</span><span class="n">shapes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">token</span><span class="p">,</span> <span class="n">collision</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s2">"type"</span><span class="p">]</span> <span class="o">==</span> <span class="s2">"separate"</span><span class="p">:</span>
            <span class="n">method</span> <span class="o">=</span> <span class="s2">"on_separation_from_"</span> <span class="o">+</span> <span class="n">other_class</span>
            <span class="n">method</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_method</span><span class="p">(</span><span class="n">arbiter</span><span class="o">.</span><span class="n">shapes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">token</span><span class="p">,</span> <span class="n">method</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">method</span> <span class="ow">and</span> <span class="n">callable</span><span class="p">(</span><span class="n">method</span><span class="p">):</span>
                <span class="n">rvalue</span> <span class="o">=</span> <span class="n">method</span><span class="p">(</span><span class="n">arbiter</span><span class="o">.</span><span class="n">shapes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">token</span><span class="p">,</span> <span class="n">collision</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">rvalue</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">rvalue</span>

    <span class="k">def</span> <span class="nf">pass_physics_collision_to_tokens</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arbiter</span><span class="p">,</span> <span class="n">space</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="n">collision</span> <span class="o">=</span> <span class="p">()</span>
        <span class="n">token</span> <span class="o">=</span> <span class="n">arbiter</span><span class="o">.</span><span class="n">shapes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">token</span>
        <span class="n">method_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">func</span> <span class="k">for</span> <span class="n">func</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="vm">__class__</span><span class="p">)</span> <span class="k">if</span>
                       <span class="n">callable</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="n">func</span><span class="p">))</span> <span class="ow">and</span> <span class="p">(</span>
                               <span class="n">func</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">Board</span><span class="o">.</span><span class="n">begin_prefix</span><span class="p">)</span> <span class="ow">or</span> <span class="n">func</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">Board</span><span class="o">.</span><span class="n">separate_prefix</span><span class="p">))]</span>
        <span class="k">for</span> <span class="n">method_name</span> <span class="ow">in</span> <span class="n">method_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">method_name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">Board</span><span class="o">.</span><span class="n">begin_prefix</span><span class="p">):</span>
                <span class="n">registered_class_name</span> <span class="o">=</span> <span class="n">method_name</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">Board</span><span class="o">.</span><span class="n">begin_prefix</span><span class="p">):]</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span>
            <span class="k">elif</span> <span class="n">method_name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">Board</span><span class="o">.</span><span class="n">separate_prefix</span><span class="p">):</span>
                <span class="n">registered_class_name</span> <span class="o">=</span> <span class="n">method_name</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">Board</span><span class="o">.</span><span class="n">separate_prefix</span><span class="p">):]</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span>
            <span class="n">registered_class</span> <span class="o">=</span> <span class="n">Board</span><span class="o">.</span><span class="n">_get_token_class_by_name</span><span class="p">(</span><span class="n">registered_class_name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">registered_class</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">child_classes_of_registered</span> <span class="o">=</span> <span class="n">registered_class</span><span class="o">.</span><span class="n">all_subclasses</span><span class="p">()</span><span class="o">.</span><span class="n">union</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">child_classes_of_registered</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">registered_classes</span> <span class="o">=</span> <span class="n">child_classes_of_registered</span><span class="o">.</span><span class="n">union</span><span class="p">({</span><span class="n">registered_class</span><span class="p">})</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">registered_classes</span> <span class="o">=</span> <span class="n">child_classes_of_registered</span> <span class="o">=</span> <span class="p">{</span><span class="n">registered_class</span><span class="p">}</span>
                <span class="n">other</span> <span class="o">=</span> <span class="n">arbiter</span><span class="o">.</span><span class="n">shapes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">token</span>
                <span class="n">other_class</span> <span class="o">=</span> <span class="n">arbiter</span><span class="o">.</span><span class="n">shapes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">token</span><span class="o">.</span><span class="vm">__class__</span>
                <span class="n">other_class_name</span> <span class="o">=</span> <span class="n">other_class</span><span class="o">.</span><span class="vm">__name__</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">other_class</span> <span class="ow">in</span> <span class="n">registered_classes</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s2">"type"</span><span class="p">]</span> <span class="o">==</span> <span class="s2">"begin"</span><span class="p">:</span>
                        <span class="n">method_name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">Board</span><span class="o">.</span><span class="n">begin_prefix</span> <span class="o">+</span> <span class="n">registered_class_name</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s2">"type"</span><span class="p">]</span> <span class="o">==</span> <span class="s2">"separate"</span><span class="p">:</span>
                        <span class="n">method_name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">Board</span><span class="o">.</span><span class="n">separate_prefix</span> <span class="o">+</span> <span class="n">registered_class_name</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                    <span class="n">method</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_method</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">method_name</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">method</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_call_method</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="p">[</span><span class="n">other</span><span class="p">,</span> <span class="n">collision</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">add_event_handler_for_class</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subcls</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">handler</span><span class="p">):</span>
        <span class="n">handler</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">subcls</span><span class="p">,</span> <span class="s2">"on_"</span> <span class="o">+</span> <span class="n">event</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">callable</span><span class="p">(</span><span class="n">handler</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">registered_event_handlers_for_tokens</span><span class="p">[</span><span class="n">subcls</span><span class="p">][</span><span class="n">event</span><span class="p">]</span> <span class="o">=</span> <span class="n">handler</span>

    <span class="s2">" @decorator"</span>
    <span class="k">def</span> <span class="nf">register</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="p">):</span>
        <span class="n">bound_method</span> <span class="o">=</span> <span class="n">method</span><span class="o">.</span><span class="fm">__get__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">)</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">bound_method</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">bound_method</span>

    <span class="k">def</span> <span class="nf">send_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">send_event_to_containers</span><span class="p">(</span><span class="s2">"message"</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span></div>


</pre></div>
      </article>
      <footer>
        
        <div class="related-pages">
          
          
        </div>

        <div class="related-information">
              Copyright &#169; 2021, Andreas Siebel
            |
            Built with <a href="https://www.sphinx-doc.org/">Sphinx</a>
              and
              <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
              <a href="https://github.com/pradyunsg/furo">Furo theme</a>.
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer no-toc">
      
      
      
    </aside>
  </main>
</div>
    <script id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
    <script >mermaid.initialize({startOnLoad:true});</script>
    <script src="../../../_static/scripts/main.js?digest=e931d09b2a40c1bb82b542effe772014573baf67"></script></body>
</html>